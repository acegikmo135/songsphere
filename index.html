<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="assets/logo.png">
    <title>Song Sphere</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        :root {
            --bg-color-light: #f0f2f5;
            --text-color-light: #333;
            --primary-color-light: #6c5ce7;
            --card-bg-light: #fff;
            --border-color-light: #e0e0e0;

            --bg-color-dark: #000000;
            --text-color-dark: #e0e0e0;
            --primary-color-dark: #ff4757;
            --card-bg-dark: #151515;
            --border-color-dark: #3a3a5f;

            --gradient-start-rgb: 255, 0, 150;
            --gradient-mid-rgb: 0, 200, 255;
            --gradient-end-rgb: 150, 0, 255;
            --gradient-dark-start-rgb: 255, 71, 87;
            --gradient-dark-mid-rgb: 255, 140, 0;
            --gradient-dark-end-rgb: 255, 20, 147;
        }

        body {
            font-family: 'Poppins', sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-color: var(--bg-color-light);
            color: var(--text-color-light);
            transition: background-color 0.3s ease, color 0.3s ease;
            overflow-x: hidden;
            line-height: 1.6;
            position: relative;
        }

        body.dark-theme {
            background-color: var(--bg-color-dark);
            color: var(--text-color-dark);
        }

        /* --- ** NEW: Upgraded Loader Styles ** --- */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: var(--bg-color-light);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            transition: opacity 0.5s ease-out, visibility 0.5s ease-out;
        }

        body.dark-theme .loading-screen {
            background-color: var(--bg-color-dark);
        }

        .loader {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            padding: 6px;
            background: conic-gradient(from 0deg at 50% 50%, #ff0096, #00c8ff, #9600ff, #ff0096) 0% 0% / 100% 100% no-repeat;
            animation: spin 1.2s linear infinite, glow 1.5s ease-in-out infinite alternate;
            margin-bottom: 25px;
        }
        
        body.dark-theme .loader {
             background: conic-gradient(from 0deg at 50% 50%, #ff4757, #ff8c00, #ff1493, #ff4757) 0% 0% / 100% 100% no-repeat;
             animation: spin 1.2s linear infinite, glowDark 1.5s ease-in-out infinite alternate;
        }

        .loader::before {
            content: '';
            display: block;
            width: 100%;
            height: 100%;
            background-color: var(--bg-color-light);
            border-radius: 50%;
        }
        body.dark-theme .loader::before {
            background-color: var(--bg-color-dark);
        }

        .loading-screen p {
            font-size: 1.2em;
            color: var(--text-color-light);
        }
        body.dark-theme .loading-screen p {
            color: var(--text-color-dark);
        }

        @keyframes spin { 100% { transform: rotate(360deg); } }
        @keyframes glow {
            from { box-shadow: 0 0 10px -5px var(--primary-color-light); }
            to { box-shadow: 0 0 25px 5px var(--primary-color-light); }
        }
        @keyframes glowDark {
            from { box-shadow: 0 0 10px -5px var(--primary-color-dark); }
            to { box-shadow: 0 0 25px 5px var(--primary-color-dark); }
        }

        .loading-screen.hidden {
            opacity: 0;
            visibility: hidden;
        }
        /* --- End of Loader Styles --- */


        .container {
            width: 90%;
            max-width: 900px;
            background-color: var(--card-bg-light);
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            min-height: 80vh;
            overflow: hidden;
            transition: background-color 0.3s ease, box-shadow 0.3s ease, filter 0.4s ease-in-out;
            padding-bottom: 30px;
            position: relative;
            z-index: 1;
        }

        .container.initially-hidden {
            visibility: hidden; /* Use visibility instead of display to maintain layout */
            opacity: 0;
        }
        .container.visible {
            visibility: visible;
            opacity: 1;
            transition: opacity 0.5s ease-in;
        }

        body.dark-theme .container {
            background-color: var(--card-bg-dark);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
        }

        .container.blurred {
            filter: blur(8px);
            pointer-events: none;
            user-select: none;
        }
        
        /* ... Other styles remain unchanged ... */
        .header{display:flex;justify-content:space-between;align-items:center;padding:20px 30px;border-bottom:1px solid var(--border-color-light);transition:border-color .3s ease;margin-bottom:20px;position:relative;z-index:10;background-color:inherit}body.dark-theme .header{border-color:var(--border-color-dark)}.header h1{margin:0;font-size:2.5em;font-weight:700;color:var(--primary-color-light);transition:color .3s ease}body.dark-theme .header h1{color:var(--primary-color-dark)}.header-controls{display:flex;align-items:center;gap:20px}.theme-toggle{background:0 0;border:none;font-size:2em;cursor:pointer;color:var(--text-color-light);transition:color .3s ease,transform .2s ease;outline:0;flex-shrink:0;padding:0;line-height:1}body.dark-theme .theme-toggle{color:var(--text-color-dark)}.theme-toggle:hover{transform:scale(1.1);color:var(--primary-color-light)}body.dark-theme .theme-toggle:hover{color:var(--primary-color-dark)}.hamburger-menu{display:flex;flex-direction:column;justify-content:space-around;width:30px;height:24px;cursor:pointer;padding:0;box-sizing:border-box;outline:0;position:relative;z-index:1;transition:all .3s ease;order:1}.hamburger-menu div{width:100%;height:2.5px;background-color:var(--text-color-light);border-radius:2px;transition:all .3s ease-in-out;transform-origin:center center}body.dark-theme .hamburger-menu div{background-color:var(--text-color-dark)}.sidebar{position:fixed;top:0;right:-280px;width:280px;height:100%;background:linear-gradient(to bottom,#2c3e50,#4a6480);color:#fff;padding-top:20px;transition:right .4s ease-out;z-index:999;box-shadow:none;display:flex;flex-direction:column;overflow-y:auto}.sidebar.open{right:0}.sidebar-header{display:flex;justify-content:flex-end;padding:15px 20px}.sidebar-close-btn{background:0 0;border:none;color:#fff;font-size:2em;cursor:pointer;outline:0;transition:transform .2s ease;padding:0;line-height:1}.sidebar-close-btn:hover{transform:scale(1.1)}.sidebar ul{list-style:none;padding:0;margin:0;width:100%;flex-grow:1;display:flex;flex-direction:column;justify-content:flex-start}.sidebar ul li{padding:18px 60px;text-align:left;opacity:0;transform:translateX(100px);transition:opacity .5s ease-out,transform .5s ease-out}.sidebar.open ul li:first-child{transition-delay:.1s;opacity:1;transform:translateX(0)}.sidebar.open ul li:nth-child(2){transition-delay:.2s;opacity:1;transform:translateX(0)}.sidebar.open ul li:nth-child(3){transition-delay:.3s;opacity:1;transform:translateX(0)}.sidebar.open ul li:nth-child(4){transition-delay:.4s;opacity:1;transform:translateX(0)}.sidebar.open ul li:nth-child(5){transition-delay:.5s;opacity:1;transform:translateX(0)}.sidebar.open ul li:nth-child(6){transition-delay:.6s;opacity:1;transform:translateX(0)}.sidebar.open ul li:nth-child(7){transition-delay:.7s;opacity:1;transform:translateX(0)}.sidebar ul li a{color:#fff;text-decoration:none;display:block;font-size:1.25em;font-weight:500;position:relative;overflow:hidden;padding:5px 0;border-radius:5px;transition:color .3s ease}.sidebar ul li a:before{content:'';position:absolute;bottom:0;right:0;width:0;height:3px;background-color:#ffcc00;transition:width .3s ease-out}.sidebar ul li a:hover:before{width:100%;left:0;right:auto}.sidebar ul li a:hover{color:#ffcc00}.overlay{position:fixed;top:0;left:0;width:100%;height:100%;background-color:rgba(0,0,0,.5);z-index:998;opacity:0;visibility:hidden;transition:opacity .4s ease,visibility .4s ease}.overlay.active{opacity:1;visibility:visible}.music-list-section{flex-grow:1;padding:0 30px;overflow-y:auto;position:relative;z-index:2}.music-list{display:flex;flex-direction:column;gap:10px;padding-bottom:20px}.music-item{background-color:var(--card-bg-light);border-radius:12px;padding:15px;box-shadow:0 5px 15px rgba(0,0,0,.08);display:flex;align-items:center;gap:15px;cursor:pointer;transition:transform .4s ease-out,box-shadow .2s ease,opacity .4s ease-out,filter .4s ease-out;position:relative;overflow:hidden;z-index:1}body.dark-theme .music-item{background-color:var(--card-bg-dark);box-shadow:0 5px 15px rgba(0,0,0,.35)}.music-item:hover{transform:translateY(-3px);box-shadow:0 8px 20px rgba(0,0,0,.15)}body.dark-theme .music-item:hover{box-shadow:0 8px 20px rgba(0,0,0,.45)}.music-item:before{content:'';position:absolute;top:-1px;left:-1px;right:-1px;bottom:-1px;border-radius:13px;z-index:-1;opacity:0;filter:blur(3px);transition:opacity .3s ease,filter .3s ease;background:linear-gradient(90deg,rgb(var(--gradient-start-rgb)),rgb(var(--gradient-mid-rgb)),rgb(var(--gradient-end-rgb)),rgb(var(--gradient-mid-rgb)),rgb(var(--gradient-start-rgb)));background-size:200% 100%;animation:gradientBorderLight 4s linear infinite;-webkit-mask:linear-gradient(#fff 0 0) content-box,linear-gradient(#fff 0 0);-webkit-mask-composite:xor;mask-composite:exclude}body.dark-theme .music-item:before{background:linear-gradient(90deg,rgb(var(--gradient-dark-start-rgb)),rgb(var(--gradient-dark-mid-rgb)),rgb(var(--gradient-dark-end-rgb)),rgb(var(--gradient-dark-mid-rgb)),rgb(var(--gradient-dark-start-rgb)));animation:gradientBorderDark 4s linear infinite}@keyframes gradientBorderLight{0%{background-position:0 50%}100%{background-position:100% 50%}}@keyframes gradientBorderDark{0%{background-position:0 50%}100%{background-position:100% 50%}}.music-item:hover:before{opacity:1;filter:blur(1px)}.music-item img{width:60px;height:60px;border-radius:8px;object-fit:cover;box-shadow:0 3px 8px rgba(0,0,0,.1);flex-shrink:0}.music-item-details{flex-grow:1;text-align:left;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.music-item h3{margin:0;font-size:1.1em;font-weight:600;color:var(--text-color-light);transition:color .3s ease}body.dark-theme .music-item h3{color:var(--text-color-dark)}.music-item p.artist,.music-item p.duration{margin:0;font-size:.9em;color:#888;line-height:1.3}body.dark-theme .music-item p.artist,body.dark-theme .music-item p.duration{color:#aaa}.music-item p.duration{text-align:right;flex-shrink:0;width:45px}@media (max-width:768px){.container{width:95%;margin:20px 0;padding-bottom:20px}.header{padding:15px 20px}.header h1{font-size:1.8em}.theme-toggle{font-size:1.8em}.hamburger-menu{width:28px;height:22px}.hamburger-menu div{height:2px}.sidebar-close-btn{font-size:1.8em}.music-list-section{padding:0 20px}.music-list{gap:8px}.music-item{padding:12px;gap:12px}.music-item img{width:50px;height:50px}.music-item h3{font-size:1em}.music-item p.artist,.music-item p.duration{font-size:.8em}.music-item p.duration{width:40px}}@media (max-width:480px){.header{padding:12px 15px}.header h1{font-size:1.5em}.theme-toggle{font-size:1.5em}.hamburger-menu{width:25px;height:20px}.hamburger-menu div{height:1.8px}.sidebar-close-btn{font-size:1.5em}.music-list-section{padding:0 10px}.music-item{padding:10px;gap:10px}.music-item img{width:45px;height:45px}.music-item h3{font-size:.95em}}

    </style>
</head>
<body>
    <div id="loading-screen" class="loading-screen">
        <div class="loader"></div>
        <p>Loading Music...</p>
    </div>

    <div class="container initially-hidden" id="main-container">
        <!-- Header, Main, etc. -->
        <header class="header">
            <h1>Song Sphere</h1>
            <div class="header-controls">
                <div class="hamburger-menu" id="hamburger-menu">
                    <div></div>
                    <div></div>
                    <div></div>
                </div>
                <button id="theme-toggle" class="theme-toggle">
                    <i class="fas fa-moon"></i>
                </button>
            </div>
        </header>

        <main class="music-list-section">
            <div id="music-list" class="music-list">
                </div>
        </main>
    </div>
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <button class="sidebar-close-btn" id="sidebar-close-btn">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <ul>
            <li><a href="index.html">Home</a></li>
            <li><a href="player.html">Player</a></li>
            <li><a href="playlist.html">Playlists</a></li>
            <li><a href="about.html">About</a></li>
        </ul>
    </aside>
    <div class="overlay" id="overlay"></div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const themeToggleBtn = document.getElementById('theme-toggle');
            const body = document.body;
            const mainContainer = document.getElementById('main-container');
            const musicListContainer = document.getElementById('music-list');
            const hamburgerMenu = document.getElementById('hamburger-menu');
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('overlay');
            const sidebarCloseBtn = document.getElementById('sidebar-close-btn');
            const loadingScreen = document.getElementById('loading-screen');

            let musicData = [
                { title: "Empire", artist: "Ogryzek", cover: "assets/empire.jpg", src: "musics/empire.mp3" },
                { title: "Mexican Funk Eki", artist: "", cover: "assets/eki.jpg", src: "musics/eki.mp3" },
                { title: "Slava Funk", artist: "", cover: "assets/slava.jpg", src: "musics/slava.mp3" },
                { title: "Hypnotic", artist: "", cover: "assets/hypnotic.png", src: "musics/hypnotic.mp3" },
                { title: "Funk Infernal", artist: "", cover: "assets/infernal.jpg", src: "musics/infernal.mp3" },
                { title: "El Que La Debe Funk", artist: "", cover: "assets/elque.webp", src: "musics/elque.mp3" },
                { title: "Aria Math", artist: "", cover: "assets/aria.png", src: "musics/aria.mp3" },
                { title: "Volkswagen Funk", artist: "", cover: "assets/volks.png", src: "musics/volks.mp3" },
                { title: "Technologia Funk", artist: "", cover: "assets/tech.png", src: "musics/tech.mp3" },
                { title: "Phut Hon Funk (Salesman)", artist: "", cover: "assets/sale.jpg", src: "musics/sale.mp3" },
                { title: "Avangard", artist: "", cover: "assets/ava.jpg", src: "musics/ava.mp3" },
                { title: "Aura", artist: "Ogryzek", cover: "assets/aura.jpg", src: "musics/aura.mp3" }
            ];

            // --- UI Controls ---
            themeToggleBtn.addEventListener('click', () => {
                body.classList.toggle('dark-theme');
                const icon = themeToggleBtn.querySelector('i');
                icon.className = body.classList.contains('dark-theme') ? 'fas fa-sun' : 'fas fa-moon';
            });
            hamburgerMenu.addEventListener('click', () => openSidebar());
            sidebarCloseBtn.addEventListener('click', () => closeSidebar());
            overlay.addEventListener('click', () => closeSidebar());

            function openSidebar() { /* ... */ }
            function closeSidebar() { /* ... */ }
            function formatTime(seconds) {
                if (isNaN(seconds) || seconds < 0) return "0:00";
                const m = Math.floor(seconds / 60);
                const s = Math.floor(seconds % 60);
                return `${m}:${s < 10 ? '0' : ''}${s}`;
            }

            // --- ** NEW: Smart Loading Logic ** ---
            const storedData = sessionStorage.getItem('musicData');
            if (storedData) {
                // If data exists, render instantly and hide loader
                musicData = JSON.parse(storedData);
                renderMusicList(musicData);
                loadingScreen.classList.add('hidden');
                mainContainer.classList.add('visible');
            } else {
                // If no data, show loader and fetch metadata
                mainContainer.classList.remove('visible'); // Keep it hidden
                fetchAndRenderMusicList();
            }

            // Renders the list from already-loaded data
            function renderMusicList(data) {
                musicListContainer.innerHTML = '';
                data.forEach((music, index) => {
                    const musicItem = document.createElement('div');
                    musicItem.className = 'music-item';
                    musicItem.setAttribute('data-index', index);
                    musicItem.innerHTML = `
                        <img src="${music.cover}" alt="${music.title} Cover">
                        <div class="music-item-details">
                            <h3>${music.title}</h3>
                            <p class="artist">${music.artist || ' '}</p>
                        </div>
                        <p class="duration">${music.duration || '...'}</p>
                    `;
                    musicListContainer.appendChild(musicItem);
                    musicItem.addEventListener('click', () => {
                        window.location.href = `player.html?songIndex=${index}`;
                    });
                });
            }
            
            // Fetches metadata for the first time
            function fetchAndRenderMusicList() {
                let loadedCount = 0;
                const totalSongs = musicData.length;

                musicData.forEach((music, index) => {
                    const audio = new Audio(music.src);
                    audio.preload = 'metadata';
                    audio.addEventListener('loadedmetadata', () => {
                        music.duration = formatTime(audio.duration);
                        checkAllLoaded();
                    });
                    audio.addEventListener('error', () => {
                        music.duration = "Error";
                        checkAllLoaded();
                    });
                });

                function checkAllLoaded() {
                    loadedCount++;
                    if (loadedCount === totalSongs) {
                        sessionStorage.setItem('musicData', JSON.stringify(musicData));
                        renderMusicList(musicData);
                        loadingScreen.classList.add('hidden');
                        mainContainer.classList.add('visible');
                    }
                }
            }
        });
    </script>
</body>
</html>